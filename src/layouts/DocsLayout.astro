---
import BaseLayout from './BaseLayout.astro';
import Header from '@/components/Header.astro';
import Footer from '@/components/Footer.astro';

export interface Props {
  title: string;
  description?: string;
  currentPath?: string;
}

import { generateDocsNavigation } from '@/utils/markdown';

const { title, description, currentPath } = Astro.props;

// åŠ¨æ€ç”Ÿæˆæ–‡æ¡£å¯¼èˆªç»“æ„
let docsNavigation;
try {
  docsNavigation = generateDocsNavigation();
} catch (error) {
  console.error('Error generating docs navigation:', error);
  // å›é€€åˆ°é™æ€å¯¼èˆª
  docsNavigation = [
    {
      title: 'å¼€å§‹ä½¿ç”¨',
      items: [
        { name: 'ä»‹ç»', href: '/docs', icon: 'ğŸ“–' },
        { name: 'å®‰è£…æŒ‡å—', href: '/docs/installation/windows', icon: 'ğŸ”§' },
        { name: 'å¿«é€Ÿå…¥é—¨', href: '/docs/user-guide/getting-started', icon: 'ğŸš€' },
      ]
    },
    {
      title: 'ç”¨æˆ·æŒ‡å—',
      items: [
        { name: 'è®¾å¤‡è¿æ¥', href: '/docs/user-guide/device-connection', icon: 'ğŸ”Œ' },
        { name: 'è¿œç¨‹æ§åˆ¶', href: '/docs/user-guide/remote-control', icon: 'ğŸ“±' },
        { name: 'æ–‡ä»¶ç®¡ç†', href: '/docs/user-guide/file-management', icon: 'ğŸ“' },
        { name: 'åº”ç”¨ç®¡ç†', href: '/docs/user-guide/app-management', icon: 'ğŸ“¦' },
        { name: 'æ‰¹é‡æ“ä½œ', href: '/docs/user-guide/batch-operations', icon: 'âš¡' },
      ]
    },
    {
      title: 'å¸®åŠ©',
      items: [
        { name: 'æ•…éšœæ’é™¤', href: '/docs/troubleshooting', icon: 'ğŸ”§' },
        { name: 'å¸¸è§é—®é¢˜', href: '/docs/troubleshooting/faq', icon: 'â“' },
        { name: 'è”ç³»æ”¯æŒ', href: '/about-contact', icon: 'ğŸ’¬' },
      ]
    }
  ];
}

// è·å–å½“å‰è·¯å¾„ï¼Œç”¨äºé«˜äº®å¯¼èˆª
const currentUrl = Astro.url.pathname;
---

<BaseLayout title={title} description={description}>
  <!-- åœ¨headä¸­æ·»åŠ æ ·å¼å’Œè„šæœ¬ -->
  <link rel="stylesheet" href="/src/styles/markdown.css" slot="head" />
  <script src="/js/syntax-highlight.js" slot="head"></script>

  <div class="min-h-screen flex flex-col">
    <!-- ç»Ÿä¸€å¯¼èˆªæ  -->
    <Header />

    <!-- æ–‡æ¡£å†…å®¹åŒºåŸŸ -->
    <div class="flex-grow bg-gray-50 dark:bg-gray-900">
      <!-- é¢åŒ…å±‘å¯¼èˆª -->
      <div class="bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <div class="py-4">
            <nav class="flex items-center space-x-2 text-sm text-gray-500 dark:text-gray-400">
              <a href="/" class="hover:text-gray-700 dark:hover:text-gray-300">é¦–é¡µ</a>
              <span>/</span>
              <a href="/docs" class="hover:text-gray-700 dark:hover:text-gray-300">æ–‡æ¡£</a>
              {currentPath && (
                <>
                  <span>/</span>
                  <span class="text-gray-900 dark:text-white">{currentPath}</span>
                </>
              )}
            </nav>
            <h1 class="mt-2 text-3xl font-bold text-gray-900 dark:text-white">{title}</h1>
            {description && (
              <p class="mt-2 text-lg text-gray-600 dark:text-gray-300">{description}</p>
            )}
          </div>
        </div>
      </div>

      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div class="flex flex-col lg:flex-row gap-8">
          <!-- ä¾§è¾¹æ å¯¼èˆª -->
          <aside class="lg:w-64 flex-shrink-0">
            <div class="sticky top-20">
            <!-- ç§»åŠ¨ç«¯èœå•æŒ‰é’® -->
            <div class="lg:hidden mb-4">
              <button
                type="button"
                class="docs-menu-toggle w-full flex items-center justify-between px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-700"
              >
                <span>æ–‡æ¡£å¯¼èˆª</span>
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                </svg>
              </button>
            </div>

            <!-- å¯¼èˆªèœå• -->
            <nav class="docs-menu hidden lg:block bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4">
              {docsNavigation.map((section: any) => (
                <div class="mb-6 last:mb-0">
                  <h3 class="text-sm font-semibold text-gray-900 dark:text-white mb-3 uppercase tracking-wider">
                    {section.title}
                  </h3>
                  <ul class="space-y-2">
                    {section.items.map((item: any) => (
                      <li>
                        <a
                          href={item.href}
                          class={`flex items-center space-x-3 px-3 py-2 text-sm rounded-md transition-colors duration-200 ${
                            currentUrl === item.href || currentUrl.startsWith(item.href + '/')
                              ? 'bg-blue-50 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300 font-medium'
                              : 'text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white hover:bg-gray-50 dark:hover:bg-gray-700'
                          }`}
                        >
                          <span class="text-base">{item.icon}</span>
                          <span>{item.name}</span>
                        </a>
                      </li>
                    ))}
                  </ul>
                </div>
              ))}
            </nav>
            </div>
          </aside>

          <!-- ä¸»å†…å®¹åŒºåŸŸ -->
          <main class="flex-1 min-w-0">
            <div class="bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6 lg:p-8">
              <div class="prose prose-gray dark:prose-invert max-w-none">
                <slot />
              </div>
            </div>

            <!-- é¡µé¢å¯¼èˆª -->
            <div class="mt-8 flex justify-between items-center pt-6 border-t border-gray-200 dark:border-gray-700">
              <div class="flex-1">
                <!-- ä¸Šä¸€é¡µé“¾æ¥å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                <div id="prev-page"></div>
              </div>
              <div class="flex-1 text-right">
                <!-- ä¸‹ä¸€é¡µé“¾æ¥å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                <div id="next-page"></div>
              </div>
            </div>
          </main>
        </div>
      </div>
    </div>

    <!-- ç»Ÿä¸€é¡µè„š -->
    <Footer />
  </div>
</BaseLayout>

<style>
  /* è‡ªå®šä¹‰proseæ ·å¼ */
  .prose {
    @apply text-gray-900 dark:text-gray-100;
  }
  
  .prose h1 {
    @apply text-3xl font-bold text-gray-900 dark:text-white border-b border-gray-200 dark:border-gray-700 pb-4 mb-6;
  }
  
  .prose h2 {
    @apply text-2xl font-semibold text-gray-900 dark:text-white mt-8 mb-4;
  }
  
  .prose h3 {
    @apply text-xl font-semibold text-gray-900 dark:text-white mt-6 mb-3;
  }
  
  .prose p {
    @apply text-gray-700 dark:text-gray-300 leading-relaxed mb-4;
  }
  
  .prose a {
    @apply text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 no-underline hover:underline;
  }
  
  .prose ul, .prose ol {
    @apply text-gray-700 dark:text-gray-300 mb-4;
  }
  
  .prose li {
    @apply mb-2;
  }
  
  .prose code {
    @apply bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-gray-100 px-2 py-1 rounded text-sm;
  }
  
  .prose pre {
    @apply bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-gray-100 p-4 rounded-lg overflow-x-auto mb-4;
  }
  
  .prose blockquote {
    @apply border-l-4 border-blue-500 pl-4 italic text-gray-600 dark:text-gray-400 mb-4;
  }
  
  .prose table {
    @apply w-full border-collapse border border-gray-300 dark:border-gray-600 mb-4;
  }
  
  .prose th, .prose td {
    @apply border border-gray-300 dark:border-gray-600 px-4 py-2 text-left;
  }
  
  .prose th {
    @apply bg-gray-50 dark:bg-gray-700 font-semibold;
  }
</style>

<script>
  // ç§»åŠ¨ç«¯èœå•åˆ‡æ¢
  document.addEventListener('DOMContentLoaded', () => {
    const menuToggle = document.querySelector('.docs-menu-toggle');
    const menu = document.querySelector('.docs-menu');
    
    if (menuToggle && menu) {
      menuToggle.addEventListener('click', () => {
        menu.classList.toggle('hidden');
        
        // æ—‹è½¬ç®­å¤´å›¾æ ‡
        const icon = menuToggle.querySelector('svg');
        if (icon) {
          icon.style.transform = menu.classList.contains('hidden') ? 'rotate(0deg)' : 'rotate(180deg)';
        }
      });
    }
  });
</script>
