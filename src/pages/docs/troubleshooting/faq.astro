---
import DocsLayout from '@/layouts/DocsLayout.astro';
import MarkdownRenderer from '@/components/MarkdownRenderer.astro';
import { readFileSync } from 'fs';
import { join } from 'path';

// è¯»å–markdownæ–‡ä»¶å†…å®¹
const markdownPath = join(process.cwd(), 'public/docs/troubleshooting/faq.md');
let markdownContent = '';

try {
  markdownContent = readFileSync(markdownPath, 'utf-8');
  // ç§»é™¤markdownçš„å‰ç½®æ ‡é¢˜ï¼Œå› ä¸ºæˆ‘ä»¬åœ¨å¸ƒå±€ä¸­å·²ç»æœ‰äº†
  markdownContent = markdownContent.replace(/^# .*\n\n/, '');
} catch (error) {
  console.error('Error reading markdown file:', error);
  markdownContent = 'æ–‡æ¡£å†…å®¹åŠ è½½å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•ã€‚';
}
---

<DocsLayout 
  title="å¸¸è§é—®é¢˜è§£ç­”" 
  description="ç”¨æˆ·æœ€å¸¸é‡åˆ°çš„é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ"
  currentPath="å¸¸è§é—®é¢˜"
>
  <!-- æœç´¢æ¡† -->
  <div class="not-prose mb-8">
    <div class="bg-blue-50 dark:bg-blue-900/20 rounded-lg p-6 border border-blue-200 dark:border-blue-700">
      <h2 class="text-xl font-semibold text-gray-900 dark:text-white mb-4 flex items-center">
        <span class="text-2xl mr-2">ğŸ”</span>
        å¿«é€ŸæŸ¥æ‰¾é—®é¢˜
      </h2>
      <div class="relative">
        <input
          type="text"
          id="faq-search"
          placeholder="è¾“å…¥å…³é”®è¯æœç´¢é—®é¢˜..."
          class="w-full px-4 py-3 pl-12 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-900 dark:text-white"
        />
        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
          <svg class="h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
          </svg>
        </div>
      </div>
      <p class="text-gray-600 dark:text-gray-300 text-sm mt-2">
        è¾“å…¥å…³é”®è¯å¦‚"è¿æ¥"ã€"å®‰è£…"ã€"æ¿€æ´»"ç­‰æ¥å¿«é€Ÿæ‰¾åˆ°ç›¸å…³é—®é¢˜
      </p>
    </div>
  </div>

  <!-- é—®é¢˜åˆ†ç±»å¿«é€Ÿå¯¼èˆª -->
  <div class="not-prose mb-8">
    <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-6">é—®é¢˜åˆ†ç±»</h2>
    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4">
      <a href="#installation" class="flex flex-col items-center p-4 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 hover:shadow-md transition-shadow duration-300 text-center">
        <span class="text-3xl mb-2">ğŸ”§</span>
        <span class="text-sm font-medium text-gray-900 dark:text-white">å®‰è£…å¯åŠ¨</span>
      </a>
      <a href="#connection" class="flex flex-col items-center p-4 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 hover:shadow-md transition-shadow duration-300 text-center">
        <span class="text-3xl mb-2">ğŸ“±</span>
        <span class="text-sm font-medium text-gray-900 dark:text-white">è®¾å¤‡è¿æ¥</span>
      </a>
      <a href="#features" class="flex flex-col items-center p-4 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 hover:shadow-md transition-shadow duration-300 text-center">
        <span class="text-3xl mb-2">ğŸ®</span>
        <span class="text-sm font-medium text-gray-900 dark:text-white">åŠŸèƒ½ä½¿ç”¨</span>
      </a>
      <a href="#settings" class="flex flex-col items-center p-4 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 hover:shadow-md transition-shadow duration-300 text-center">
        <span class="text-3xl mb-2">âš™ï¸</span>
        <span class="text-sm font-medium text-gray-900 dark:text-white">è®¾ç½®é…ç½®</span>
      </a>
      <a href="#license" class="flex flex-col items-center p-4 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 hover:shadow-md transition-shadow duration-300 text-center">
        <span class="text-3xl mb-2">ğŸ”</span>
        <span class="text-sm font-medium text-gray-900 dark:text-white">è®¸å¯æ¿€æ´»</span>
      </a>
      <a href="#updates" class="flex flex-col items-center p-4 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 hover:shadow-md transition-shadow duration-300 text-center">
        <span class="text-3xl mb-2">ğŸ”„</span>
        <span class="text-sm font-medium text-gray-900 dark:text-white">æ›´æ–°å‡çº§</span>
      </a>
    </div>
  </div>

  <!-- çƒ­é—¨é—®é¢˜ -->
  <div class="not-prose mb-8">
    <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-6">ğŸ”¥ çƒ­é—¨é—®é¢˜</h2>
    <div class="space-y-4">
      <div class="bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-700 rounded-lg p-4">
        <h3 class="font-semibold text-gray-900 dark:text-white mb-2 flex items-center">
          <span class="text-red-500 mr-2">ğŸ”¥</span>
          è®¾å¤‡è¿æ¥åç«‹å³æ–­å¼€
        </h3>
        <p class="text-gray-600 dark:text-gray-300 text-sm mb-2">
          æœ€å¸¸è§çš„è¿æ¥é—®é¢˜ï¼Œé€šå¸¸æ˜¯ç”µæºç®¡ç†å¯¼è‡´çš„ã€‚
        </p>
        <a href="#device-disconnect" class="text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-300 text-sm font-medium">
          æŸ¥çœ‹è§£å†³æ–¹æ¡ˆ â†’
        </a>
      </div>

      <div class="bg-orange-50 dark:bg-orange-900/20 border border-orange-200 dark:border-orange-700 rounded-lg p-4">
        <h3 class="font-semibold text-gray-900 dark:text-white mb-2 flex items-center">
          <span class="text-orange-500 mr-2">ğŸ”¥</span>
          ç¨‹åºå®‰è£…åæ— æ³•å¯åŠ¨
        </h3>
        <p class="text-gray-600 dark:text-gray-300 text-sm mb-2">
          é€šå¸¸æ˜¯ç¼ºå°‘è¿è¡Œåº“æˆ–æƒé™é—®é¢˜å¯¼è‡´çš„ã€‚
        </p>
        <a href="#startup-failed" class="text-orange-600 dark:text-orange-400 hover:text-orange-800 dark:hover:text-orange-300 text-sm font-medium">
          æŸ¥çœ‹è§£å†³æ–¹æ¡ˆ â†’
        </a>
      </div>

      <div class="bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-700 rounded-lg p-4">
        <h3 class="font-semibold text-gray-900 dark:text-white mb-2 flex items-center">
          <span class="text-yellow-500 mr-2">ğŸ”¥</span>
          å±å¹•é•œåƒå»¶è¿Ÿé«˜æˆ–å¡é¡¿
        </h3>
        <p class="text-gray-600 dark:text-gray-300 text-sm mb-2">
          æ€§èƒ½ä¼˜åŒ–é—®é¢˜ï¼Œå¯ä»¥é€šè¿‡è°ƒæ•´è®¾ç½®æ”¹å–„ã€‚
        </p>
        <a href="#performance-lag" class="text-yellow-600 dark:text-yellow-400 hover:text-yellow-800 dark:hover:text-yellow-300 text-sm font-medium">
          æŸ¥çœ‹è§£å†³æ–¹æ¡ˆ â†’
        </a>
      </div>
    </div>
  </div>

  <!-- ä¸»è¦å†…å®¹ -->
  <div id="faq-content">
    <MarkdownRenderer content={markdownContent} />
  </div>

  <!-- æ²¡æ‰¾åˆ°ç­”æ¡ˆ -->
  <div class="not-prose mt-12">
    <div class="bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 rounded-xl p-6 border border-blue-200 dark:border-blue-700">
      <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center">
        <span class="text-2xl mr-2">â“</span>
        æ²¡æ‰¾åˆ°æ‚¨è¦çš„ç­”æ¡ˆï¼Ÿ
      </h3>
      <p class="text-gray-600 dark:text-gray-300 mb-4">
        å¦‚æœä»¥ä¸Šå¸¸è§é—®é¢˜æ²¡æœ‰è§£å†³æ‚¨çš„ç–‘é—®ï¼Œæˆ‘ä»¬è¿˜æœ‰æ›´å¤šè·å–å¸®åŠ©çš„æ–¹å¼ï¼š
      </p>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <a href="/docs/troubleshooting" class="flex items-center p-4 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 hover:shadow-md transition-shadow duration-300">
          <span class="text-2xl mr-3">ğŸ”§</span>
          <div>
            <h4 class="font-semibold text-gray-900 dark:text-white">æ•…éšœæ’é™¤</h4>
            <p class="text-gray-600 dark:text-gray-300 text-sm">è¯¦ç»†çš„é—®é¢˜è¯Šæ–­</p>
          </div>
        </a>
        <a href="https://www.lacs.cc/contact" class="flex items-center p-4 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 hover:shadow-md transition-shadow duration-300">
          <span class="text-2xl mr-3">ğŸ“§</span>
          <div>
            <h4 class="font-semibold text-gray-900 dark:text-white">è”ç³»æ”¯æŒ</h4>
            <p class="text-gray-600 dark:text-gray-300 text-sm">ä¸“ä¸šæŠ€æœ¯æ”¯æŒ</p>
          </div>
        </a>
        <a href="https://github.com/yourcompany/android-device-management-tool/issues" class="flex items-center p-4 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 hover:shadow-md transition-shadow duration-300">
          <span class="text-2xl mr-3">ğŸ’¬</span>
          <div>
            <h4 class="font-semibold text-gray-900 dark:text-white">ç¤¾åŒºè®¨è®º</h4>
            <p class="text-gray-600 dark:text-gray-300 text-sm">ä¸å…¶ä»–ç”¨æˆ·äº¤æµ</p>
          </div>
        </a>
      </div>
    </div>
  </div>
</DocsLayout>

<script>
  // FAQæœç´¢åŠŸèƒ½
  document.addEventListener('DOMContentLoaded', () => {
    const searchInput = document.getElementById('faq-search');
    const faqContent = document.getElementById('faq-content');
    
    if (searchInput && faqContent) {
      let searchTimeout;
      
      searchInput.addEventListener('input', (e) => {
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(() => {
          const query = e.target.value.toLowerCase().trim();
          
          if (query === '') {
            // æ˜¾ç¤ºæ‰€æœ‰å†…å®¹
            const allElements = faqContent.querySelectorAll('h2, h3, p, li, details');
            allElements.forEach(el => {
              el.style.display = '';
            });
            return;
          }
          
          // æœç´¢åŒ¹é…çš„å†…å®¹
          const allElements = faqContent.querySelectorAll('h2, h3, p, li, details');
          let hasResults = false;
          
          allElements.forEach(el => {
            const text = el.textContent.toLowerCase();
            if (text.includes(query)) {
              el.style.display = '';
              hasResults = true;
              
              // å¦‚æœæ˜¯detailså…ƒç´ ï¼Œè‡ªåŠ¨å±•å¼€
              if (el.tagName === 'DETAILS') {
                el.open = true;
              }
            } else {
              el.style.display = 'none';
            }
          });
          
          // å¦‚æœæ²¡æœ‰ç»“æœï¼Œæ˜¾ç¤ºæç¤º
          if (!hasResults) {
            const noResults = document.createElement('div');
            noResults.className = 'text-center py-8 text-gray-500 dark:text-gray-400';
            noResults.innerHTML = `
              <div class="text-4xl mb-4">ğŸ”</div>
              <p class="text-lg font-medium mb-2">æ²¡æœ‰æ‰¾åˆ°ç›¸å…³é—®é¢˜</p>
              <p class="text-sm">å°è¯•ä½¿ç”¨å…¶ä»–å…³é”®è¯ï¼Œæˆ–è€…<a href="https://www.lacs.cc/contact" class="text-blue-600 dark:text-blue-400 hover:underline">è”ç³»æŠ€æœ¯æ”¯æŒ</a></p>
            `;
            noResults.id = 'no-results';
            
            // ç§»é™¤ä¹‹å‰çš„æ— ç»“æœæç¤º
            const existingNoResults = document.getElementById('no-results');
            if (existingNoResults) {
              existingNoResults.remove();
            }
            
            faqContent.appendChild(noResults);
          } else {
            // ç§»é™¤æ— ç»“æœæç¤º
            const existingNoResults = document.getElementById('no-results');
            if (existingNoResults) {
              existingNoResults.remove();
            }
          }
        }, 300);
      });
    }
    
    // å¹³æ»‘æ»šåŠ¨åˆ°é”šç‚¹
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
          target.scrollIntoView({
            behavior: 'smooth',
            block: 'start'
          });
        }
      });
    });
  });
</script>
